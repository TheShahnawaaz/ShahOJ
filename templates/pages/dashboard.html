{% extends "layouts/base.html" %}
{% from "layouts/components.html" import enhanced_breadcrumb, problem_header, enhanced_card %}

{% block title %}Dashboard - ShahOJ{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-color: #007bff;
        --success-color: #28a745;
        --warning-color: #ffc107;
        --danger-color: #dc3545;
        --info-color: #17a2b8;
        --light-color: #f8f9fa;
        --dark-color: #343a40;
        --border-radius: 8px;
        --box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        --transition: all 0.3s ease;
    }

    body {
        background-color: #f5f7fa;
    }

    /* Enhanced Layout */
    .edit-container {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        margin-bottom: 2rem;
    }

    /* Progress Bar */
    .progress-header {
        background: linear-gradient(135deg, var(--primary-color), #0056b3);
        color: white;
        padding: 1rem;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
    }

    /* Enhanced Buttons */
    .btn-enhanced {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-weight: 500;
        transition: var(--transition);
        border: 1px solid transparent;
    }

    .btn-enhanced:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .card {
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        border: 1px solid #e9ecef;
        margin-bottom: 1.5rem;
    }

    .card-header {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-bottom: 1px solid #dee2e6;
        font-weight: 600;
    }

    /* Enhanced Statistics Cards */
    .stats-card {
        background: linear-gradient(135deg, var(--primary-color), #0056b3);
        color: white;
        border: none;
        text-align: center;
        transition: var(--transition);
        cursor: pointer;
    }

    .stats-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,123,255,0.3);
    }

    .stats-card.success {
        background: linear-gradient(135deg, var(--success-color), #1e7e34);
    }

    .stats-card.success:hover {
        box-shadow: 0 8px 25px rgba(40,167,69,0.3);
    }

    .stats-card.info {
        background: linear-gradient(135deg, var(--info-color), #117a8b);
    }

    .stats-card.info:hover {
        box-shadow: 0 8px 25px rgba(23,162,184,0.3);
    }

    .stats-card.warning {
        background: linear-gradient(135deg, var(--warning-color), #d39e00);
        color: var(--dark-color);
    }

    .stats-card.warning:hover {
        box-shadow: 0 8px 25px rgba(255,193,7,0.3);
    }

    .stats-card .card-body {
        padding: 2rem 1.5rem;
    }

    .stats-card i {
        opacity: 0.8;
        margin-bottom: 1rem;
    }

    .stats-card h2 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .stats-card p {
        font-size: 1rem;
        opacity: 0.9;
        margin: 0;
    }

    /* Enhanced Table */
    .table-hover tbody tr:hover {
        background-color: rgba(0,123,255,0.05);
        transition: var(--transition);
    }

    .table th {
        border-top: none;
        font-weight: 600;
        color: var(--dark-color);
        background-color: #f8f9fa;
    }

    /* Problem Title Links */
    .problem-title-link {
        color: var(--primary-color);
        font-weight: 600;
        transition: var(--transition);
    }

    .clickable-row {
        cursor: pointer;
        transition: var(--transition);
    }

    .clickable-row:hover {
        background-color: rgba(0,123,255,0.1) !important;
    }

    .clickable-row:hover .problem-title-link {
        color: #0056b3;
        text-decoration: underline;
    }

    /* Action Buttons */
    .action-btn-group .btn {
        transition: var(--transition);
    }

    .action-btn-group .btn:hover {
        transform: translateY(-1px);
    }

    /* Empty State */
    .empty-state {
        padding: 4rem 2rem;
        text-align: center;
    }

    .empty-state i {
        color: #dee2e6;
        margin-bottom: 2rem;
    }

    .empty-state h4 {
        color: #6c757d;
        margin-bottom: 1rem;
    }

    .empty-state p {
        color: #6c757d;
        margin-bottom: 2rem;
    }

    /* Difficulty Progress Bars */
    .difficulty-progress {
        height: 8px;
        border-radius: 4px;
        overflow: hidden;
        background-color: #e9ecef;
        margin-top: 0.5rem;
    }

    .difficulty-progress .progress-bar {
        transition: width 0.6s ease;
    }

    /* System Info Cards */
    .system-info-item {
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 6px;
        margin-bottom: 1rem;
        border-left: 4px solid var(--primary-color);
    }

    .system-info-item strong {
        color: var(--dark-color);
    }

    .system-info-item code {
        background: white;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-size: 0.9em;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    
    <!-- Enhanced Dashboard Header -->
    {{ problem_header(
        'Dashboard',
        'Manage your competitive programming problems',
        [
            {'text': 'Create Problem', 'icon': 'fas fa-plus', 'class': 'btn-light', 'onclick': "location.href='" + url_for('create_problem_form') + "'"},
            {'text': 'Refresh', 'icon': 'fas fa-sync', 'class': 'btn-outline-light', 'onclick': 'location.reload()'}
        ]
    ) }}

    <!-- Enhanced Statistics Cards -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stats-card">
                <div class="card-body">
                    <i class="fas fa-file-code fa-3x"></i>
                    <h2>{{ stats.total_problems }}</h2>
                    <p>Total Problems</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stats-card success">
                <div class="card-body">
                    <i class="fas fa-check-circle fa-3x"></i>
                    <h2>{{ stats.total_test_cases }}</h2>
                    <p>Test Cases</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stats-card info">
                <div class="card-body">
                    <i class="fas fa-chart-line fa-3x"></i>
                    <h2>{{ stats.difficulty_breakdown.Easy + stats.difficulty_breakdown.Medium + stats.difficulty_breakdown.Hard }}</h2>
                    <p>Problems Ready</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stats-card warning">
                <div class="card-body">
                    <i class="fas fa-clock fa-3x"></i>
                    <h2>{{ stats.recent_problems|length }}</h2>
                    <p>Recent Problems</p>
                </div>
            </div>
        </div>
    </div>

    

    <!-- Problems List -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5><i class="fas fa-list"></i> Problems</h5>
            <small class="text-muted">{{ problems|length }} problems found</small>
        </div>
        <div class="card-body">
            {% if problems %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Difficulty</th>
                            <th>Tags</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for problem in problems %}
                        <tr class="clickable-row" onclick="location.href='{{ url_for('problem_detail', slug=problem.slug) }}'">
                            <td>
                                <div class="problem-title-link">
                                    {{ problem.config.get('title') or problem.slug }}
                                </div>
                                <small class="text-muted"><i class="fas fa-hashtag"></i> {{ problem.slug }}</small>
                            </td>
                            <td>
                                {% set difficulty = problem.config.get('difficulty') or 'Medium' %}
                                <span class="badge 
                                    {% if difficulty == 'Easy' %}bg-success
                                    {% elif difficulty == 'Medium' %}bg-warning text-dark
                                    {% else %}bg-danger{% endif %}">
                                    {{ difficulty }}
                                </span>
                            </td>
                            <td>
                                {% for tag in (problem.config.get('tags') or []) %}
                                <span class="badge bg-light text-dark border me-1">{{ tag }}</span>
                                {% endfor %}
                                {% if not problem.config.get('tags') %}
                                <small class="text-muted">No tags</small>
                                {% endif %}
                            </td>
                            <td>
                                <small class="text-muted">
                                    <i class="fas fa-calendar"></i> {{ (problem.config.get('created_date') or 'Unknown')[:10] }}
                                </small>
                            </td>
                            <td onclick="event.stopPropagation()">
                                <div class="btn-group btn-group-sm action-btn-group">
                                    <a href="{{ url_for('problem_detail', slug=problem.slug) }}" class="btn btn-outline-primary btn-sm" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ url_for('manage_test_cases', slug=problem.slug) }}" class="btn btn-outline-secondary btn-sm" title="Manage Tests">
                                        <i class="fas fa-cog"></i>
                                    </a>
                                    <a href="{{ url_for('test_solution_page', slug=problem.slug) }}" class="btn btn-outline-success btn-sm" title="Test Solution">
                                        <i class="fas fa-play"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-folder-open fa-5x"></i>
                <h4>No problems found</h4>
                <p>Get started by creating your first competitive programming problem!</p>
                <a href="{{ url_for('create_problem_form') }}" class="btn btn-primary btn-enhanced">
                    <i class="fas fa-plus"></i> Create Your First Problem
                </a>
            </div>
            {% endif %}
        </div>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
// Add some basic JavaScript functionality
document.addEventListener('DOMContentLoaded', function() {
    // Add click handlers for action buttons
    const actionButtons = document.querySelectorAll('.btn-group .btn');
    actionButtons.forEach(button => {
        if (button.title) {
            // Add tooltip functionality if needed
            button.setAttribute('data-bs-toggle', 'tooltip');
            button.setAttribute('data-bs-placement', 'top');
        }
    });
    
    // Initialize tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    

});
</script>
{% endblock %}
